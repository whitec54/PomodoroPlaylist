<!doctype html>

<!DOCTYPE html>
<html>

<head>
	
	<title></title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="{{ url_for('static', filename='jquery.js') }}">\x3C/script>')</script>
  <script src="http://www.youtube.com/player_api"></script>

</head>

<body>

<div id="player"></div>


<script type=text/javascript>
$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};



window.cur_vid_index = 3;
window.onYouTubePlayerAPIReady = function() {
  console.log(window.videos[window.cur_vid_index]['id']['videoId'])
  player = new YT.Player('player', {
    height: '390',
    width: '640',
    videoId: window.videos[window.cur_vid_index]['id']['videoId'],
    events: {
      'onReady': window.onPlayerReady,
      'onStateChange': window.onPlayerStateChange
    },
    playerVars:{
      start:0,
      end: window.videos[window.cur_vid_index]['end_seconds']
    }
  });
}

// autoplay video
window.onPlayerReady =function (event) {
    event.target.playVideo();
}

// when video ends
window.onPlayerStateChange = function(event) { 
    window.cur_vid_index = (window.cur_vid_index + 1)%window.videos.length;       
    if(event.data === 0) {
        player.loadVideoById({
          videoId:videos[window.cur_vid_index]['id']['videoId'],
          endSeconds:videos[window.cur_vid_index]['end_seconds']});
        
    }
}

$(document).ready(
  function() {
      $.getJSON($SCRIPT_ROOT + '/_supply_videos', {},
       function(videos) {
        console.log(videos)
        window.videos = videos;

        window.onYouTubePlayerAPIReady();
      });
      return false;
    }
)
</script>

<br/><br/>

<form>

  <label for="genre">Genre</label>
  <select id="genre">
    <option value="lofi">Lofi</option>
    <option value="edm">EDM</option>
    <option value="classical">Classical</option>
  </select>

  <label for="productiveTime">Productive</label>
  <select id="productiveTime">
    <option value="5min">5 minutes</option>
    <option value="10min">10 minutes</option>
    <option value="15min">15 minutes</option>
    <option value="20min">20 minutes</option>
    <option value="25min">25 minutes</option>
    <option value="30min">30 minutes</option>
  </select>

  <label for="breakTime">Break</label>
  <select id="breakTime">
    <option value="5min">5 minutes</option>
    <option value="10min">10 minutes</option>
    <option value="15min">15 minutes</option>
    <option value="20min">20 minutes</option>
    <option value="25min">25 minutes</option>
    <option value="30min">30 minutes</option>
  </select>

  <input type="submit" value="Submit" onclick="return userInputToJSON();"/>
 
</form>

<script>
  function userInputToJSON(){
    var selectedGenre = document.getElementById("genre").value;
    var selectedProductive = document.getElementById("productiveTime").value;
    var selectedBreak = document.getElementById("breakTime").value;

    var desiredPomodoro = {
      genre: '',
      productive: '',
      break: ''
    };

    desiredPomodoro['genre'] = selectedGenre;
    desiredPomodoro['productive'] = selectedProductive;
    desiredPomodoro['break'] = selectedBreak;

    var jsonString = JSON.stringify(desiredPomodoro);
    alert(jsonString);
    
    $.ajax({
      type: 'POST',
      url: '/desiredPomodoro',
      data: jsonString,
      dataType: 'json',
      contentType: 'application/json;charset=UTF-8',
      success: function(e){
        alert("Success???");
      }
    });
    
  }

</script>

</body>

</html>
